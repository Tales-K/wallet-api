databaseChangeLog:
  - changeSet:
      id: 001-create-enums
      author: tales.kerschner
      comment: Create enumerated types for posting_type, transfer_status, and idempotency_status
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/001-create-enums.sql
        splitStatements: false
      rollback:
        - sql:
            sql: |
              DROP TYPE IF EXISTS idempotency_status CASCADE;
              DROP TYPE IF EXISTS transfer_status CASCADE;
              DROP TYPE IF EXISTS posting_type CASCADE;

  - changeSet:
      id: 002-create-wallets-table
      author: tales.kerschner
      comment: Create wallets table with balance and timestamps
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/002-create-wallets-table.sql
      rollback:
        - sql:
            sql: DROP TABLE IF EXISTS wallets CASCADE;

  - changeSet:
      id: 003-create-transfers-table
      author: tales.kerschner
      comment: Create transfers table for wallet-to-wallet transfers
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/003-create-transfers-table.sql
      rollback:
        - sql:
            sql: DROP TABLE IF EXISTS transfers CASCADE;

  - changeSet:
      id: 004-create-ledger-entries-table
      author: tales.kerschner
      comment: Create ledger_entries table for append-only transaction log
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/004-create-ledger-entries-table.sql
      rollback:
        - sql:
            sql: DROP TABLE IF EXISTS ledger_entries CASCADE;

  - changeSet:
      id: 005-create-idempotency-keys-table
      author: tales.kerschner
      comment: Create idempotency_keys table for API-level idempotency cache
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/005-create-idempotency-keys-table.sql
      rollback:
        - sql:
            sql: DROP TABLE IF EXISTS idempotency_keys CASCADE;

  - changeSet:
      id: 006-enforce-ledger-append-only
      author: tales.kerschner
      comment: Enforce append-only semantics on ledger_entries table with triggers
      runOnChange: false
      sqlFile:
        path: classpath:db/changelog/006-enforce-ledger-append-only.sql
      rollback:
        - sql:
            sql: |
              DROP TRIGGER IF EXISTS ledger_entries_append_only ON ledger_entries;
              DROP FUNCTION IF EXISTS ledger_entries_append_only_guard() CASCADE;
